<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FightingBooks Image Audit ‚Äî Visual Review</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #0a0a0a; color: #e0e0e0; padding: 20px; }
  h1 { font-size: 1.8rem; margin-bottom: 8px; color: #fff; }
  .meta { color: #888; margin-bottom: 24px; font-size: 0.9rem; }
  .stats { display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap; }
  .stat { background: #1a1a1a; border: 1px solid #333; border-radius: 8px; padding: 10px 16px; min-width: 100px; }
  .stat-num { font-size: 1.4rem; font-weight: 700; }
  .stat-label { font-size: 0.75rem; color: #888; }
  .stat.bad .stat-num { color: #ff6b6b; }
  .stat.ok .stat-num { color: #51cf66; }
  .stat.warn .stat-num { color: #ffd43b; }
  .stat.blue .stat-num { color: #74c0fc; }

  .toolbar { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; align-items: center; }
  .toolbar button { background: #1a1a1a; border: 1px solid #444; color: #ccc; padding: 6px 14px; border-radius: 6px; cursor: pointer; font-size: 0.85rem; transition: all 0.15s; }
  .toolbar button:hover { background: #252525; border-color: #666; }
  .toolbar button.active { background: #d4af37; color: #000; border-color: #d4af37; }
  .btn-new { background: #1a2a3a !important; border-color: #2d5a8d !important; color: #74c0fc !important; }
  .btn-new:hover { background: #243a4a !important; }
  .btn-new.active { background: #74c0fc !important; color: #000 !important; border-color: #74c0fc !important; }
  .image-card.newly-replaced { border-color: #74c0fc; }
  .new-badge { position: absolute; top: 8px; left: 8px; background: #74c0fc; color: #000; font-size: 0.65rem; font-weight: 700; padding: 2px 6px; border-radius: 4px; z-index: 2; text-transform: uppercase; }
  .toolbar .sep { width: 1px; height: 28px; background: #333; margin: 0 4px; }
  .btn-export { background: #1a3a1a !important; border-color: #2d5a2d !important; color: #51cf66 !important; }
  .btn-export:hover { background: #244a24 !important; }

  .animal-section { margin-bottom: 24px; border: 1px solid #222; border-radius: 12px; overflow: hidden; }
  .animal-header { background: #151515; padding: 12px 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; user-select: none; }
  .animal-header:hover { background: #1a1a1a; }
  .animal-name { font-size: 1.15rem; font-weight: 600; text-transform: capitalize; }
  .animal-badges { display: flex; gap: 6px; align-items: center; }
  .animal-badge { font-size: 0.7rem; padding: 2px 8px; border-radius: 10px; }
  .badge-critical { background: #ff6b6b22; color: #ff6b6b; border: 1px solid #ff6b6b44; }
  .badge-moderate { background: #ffd43b22; color: #ffd43b; border: 1px solid #ffd43b44; }
  .badge-clean { background: #51cf6622; color: #51cf66; border: 1px solid #51cf6644; }
  .badge-reviewed { background: #74c0fc22; color: #74c0fc; border: 1px solid #74c0fc44; }
  .animal-body { display: none; padding: 16px; }
  .animal-body.open { display: block; }
  .image-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 14px; }

  .image-card { background: #111; border-radius: 8px; overflow: hidden; border: 2px solid #222; transition: border-color 0.2s; position: relative; }
  .image-card.has-issue { border-color: #ff6b6b44; }
  .image-card.clean { border-color: #51cf6622; }
  .image-card.flagged-ok { border-color: #51cf66; }
  .image-card.flagged-replace { border-color: #ff6b6b; }
  .image-card img { width: 100%; aspect-ratio: 1; object-fit: cover; display: block; cursor: zoom-in; }
  .image-info { padding: 10px; }
  .image-filename { font-size: 0.78rem; color: #888; font-family: monospace; }
  .image-type { font-size: 0.68rem; color: #555; text-transform: uppercase; margin-top: 2px; }
  .image-issue { margin-top: 6px; font-size: 0.82rem; color: #ff9999; line-height: 1.3; }
  .image-ok-text { margin-top: 6px; font-size: 0.82rem; color: #88cc88; }

  .flag-buttons { display: flex; gap: 6px; margin-top: 8px; }
  .flag-btn { flex: 1; padding: 6px 0; border: 1px solid #333; border-radius: 6px; cursor: pointer; font-size: 0.8rem; font-weight: 600; background: #1a1a1a; color: #888; transition: all 0.15s; }
  .flag-btn:hover { transform: scale(1.02); }
  .flag-btn.btn-ok:hover, .flag-btn.btn-ok.selected { background: #1a3a1a; border-color: #51cf66; color: #51cf66; }
  .flag-btn.btn-replace:hover, .flag-btn.btn-replace.selected { background: #3a1a1a; border-color: #ff6b6b; color: #ff6b6b; }
  .flag-badge { position: absolute; top: 8px; right: 8px; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 700; z-index: 2; }
  .flag-badge.ok-badge { background: #51cf66; color: #000; }
  .flag-badge.replace-badge { background: #ff6b6b; color: #fff; }

  /* Lightbox */
  .lightbox { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.92); z-index: 1000; justify-content: center; align-items: center; flex-direction: column; cursor: zoom-out; }
  .lightbox.active { display: flex; }
  .lightbox img { max-width: 90vw; max-height: 80vh; object-fit: contain; border-radius: 8px; }
  .lightbox-info { color: #ccc; margin-top: 12px; text-align: center; max-width: 600px; }
  .lightbox-filename { font-family: monospace; font-size: 1rem; color: #fff; }
  .lightbox-issue { color: #ff9999; margin-top: 6px; font-size: 0.9rem; }
  .lightbox-nav { position: absolute; top: 50%; transform: translateY(-50%); font-size: 2.5rem; color: #666; cursor: pointer; padding: 20px; user-select: none; }
  .lightbox-nav:hover { color: #fff; }
  .lightbox-nav.prev { left: 10px; }
  .lightbox-nav.next { right: 10px; }
  .lightbox-close { position: absolute; top: 16px; right: 24px; font-size: 2rem; color: #666; cursor: pointer; }
  .lightbox-close:hover { color: #fff; }
  .lightbox-flags { display: flex; gap: 12px; margin-top: 14px; }
  .lightbox-flags button { padding: 8px 24px; border-radius: 8px; border: 2px solid #444; font-size: 0.9rem; font-weight: 600; cursor: pointer; background: #1a1a1a; color: #888; }
  .lightbox-flags .lb-ok:hover, .lightbox-flags .lb-ok.selected { background: #1a3a1a; border-color: #51cf66; color: #51cf66; }
  .lightbox-flags .lb-replace:hover, .lightbox-flags .lb-replace.selected { background: #3a1a1a; border-color: #ff6b6b; color: #ff6b6b; }

  .progress-bar { height: 4px; background: #222; border-radius: 2px; margin-bottom: 20px; overflow: hidden; }
  .progress-fill { height: 100%; border-radius: 2px; transition: width 0.3s; display: flex; }
  .progress-ok { background: #51cf66; }
  .progress-replace { background: #ff6b6b; }
  .progress-unreviewed { background: #333; }
  .hidden { display: none !important; }
</style>
</head>
<body>

<h1>üîç FightingBooks Image Audit</h1>
<p class="meta">Click any image to expand ‚Ä¢ Green = OK, Red = Replace ‚Ä¢ Decisions auto-save</p>

<div class="stats">
  <div class="stat"><div class="stat-num">235</div><div class="stat-label">Total Images</div></div>
  <div class="stat bad"><div class="stat-num" id="ai-flagged">‚Äî</div><div class="stat-label">AI Flagged</div></div>
  <div class="stat ok"><div class="stat-num" id="reviewed-ok">0</div><div class="stat-label">‚úì Approved</div></div>
  <div class="stat bad"><div class="stat-num" id="reviewed-replace">0</div><div class="stat-label">‚úó Replace</div></div>
  <div class="stat blue"><div class="stat-num" id="unreviewed">235</div><div class="stat-label">Unreviewed</div></div>
</div>

<div class="progress-bar"><div class="progress-fill" id="progress"></div></div>

<div class="toolbar">
  <button class="active" data-filter="all">All (235)</button>
  <button data-filter="issues">AI Flagged</button>
  <button data-filter="clean">AI Clean</button>
  <div class="sep"></div>
  <button data-filter="unreviewed">Unreviewed</button>
  <button data-filter="approved">‚úì Approved</button>
  <button data-filter="replace">‚úó Replace</button>
  <div class="sep"></div>
  <button class="btn-new" data-filter="new">üÜï All Replaced (49)</button>
  <button class="btn-new" data-filter="dino" style="background:#2a2a1a !important;border-color:#8a7a2d !important;color:#fbbf24 !important">ü¶ï Dino AI+Ref (25)</button>
  <div class="sep"></div>
  <button class="btn-export" onclick="exportDecisions()">üì• Export Decisions</button>
</div>

<div id="animals"></div>

<!-- Lightbox -->
<div class="lightbox" id="lightbox">
  <span class="lightbox-close" onclick="closeLightbox()">√ó</span>
  <span class="lightbox-nav prev" onclick="navLightbox(-1)">‚Äπ</span>
  <span class="lightbox-nav next" onclick="navLightbox(1)">‚Ä∫</span>
  <img id="lb-img" src="" alt="">
  <div class="lightbox-info">
    <div class="lightbox-filename" id="lb-filename"></div>
    <div class="lightbox-issue" id="lb-issue"></div>
  </div>
  <div class="lightbox-flags">
    <button class="lb-ok" onclick="flagFromLightbox('ok')">‚úì OK ‚Äî Keep</button>
    <button class="lb-replace" onclick="flagFromLightbox('replace')">‚úó Replace</button>
  </div>
</div>

<script>
const BASE = '/fighters';
const TYPES = ['', '-closeup', '-action', '-habitat', '-secrets'];
const TYPE_LABELS = { '': 'portrait', '-closeup': 'closeup', '-action': 'action', '-habitat': 'habitat', '-secrets': 'secrets' };

// Images replaced today (Feb 16, 2026) ‚Äî for "Newly Replaced" filter
const REPLACED = new Set([
  'alligator-action.jpg', 'alligator-habitat.jpg',
  'basilisk.jpg', 'basilisk-secrets.jpg',
  'cape-buffalo-secrets.jpg',
  'cerberus.jpg', 'cerberus-secrets.jpg',
  'cheetah-habitat.jpg', 'cheetah-secrets.jpg',
  'electric-eel-habitat.jpg',
  'griffin-action.jpg',
  'hippo-secrets.jpg',
  'hydra-action.jpg', 'hydra-secrets.jpg',
  'hyena-habitat.jpg',
  'jaguar-action.jpg', 'jaguar-secrets.jpg',
  'leopard-action.jpg', 'leopard-secrets.jpg',
  'mandrill-secrets.jpg',
  'rhino-secrets.jpg',
  'walrus-secrets.jpg',
  'wolf-action.jpg',
]);

// Round 2 ‚Äî Pro model retries
const REPLACED_R2 = new Set([
  'basilisk-secrets.jpg',
  'cheetah-habitat.jpg',
  'hydra-action.jpg',
]);

// Round 3 ‚Äî Sourced dinosaur images (Wikimedia Commons)
const REPLACED_DINO = new Set([
  'ankylosaurus.jpg', 'ankylosaurus-closeup.jpg', 'ankylosaurus-action.jpg', 'ankylosaurus-habitat.jpg', 'ankylosaurus-secrets.jpg',
  'brachiosaurus.jpg', 'brachiosaurus-closeup.jpg', 'brachiosaurus-action.jpg', 'brachiosaurus-habitat.jpg', 'brachiosaurus-secrets.jpg',
  'pteranodon.jpg', 'pteranodon-closeup.jpg', 'pteranodon-action.jpg', 'pteranodon-habitat.jpg', 'pteranodon-secrets.jpg',
  'spinosaurus.jpg', 'spinosaurus-action.jpg', 'spinosaurus-secrets.jpg',
  'stegosaurus.jpg', 'stegosaurus-closeup.jpg', 'stegosaurus-action.jpg', 'stegosaurus-secrets.jpg',
  'velociraptor-action.jpg', 'velociraptor-closeup.jpg', 'velociraptor-secrets.jpg',
]);

// Combine all replaced
const ALL_REPLACED = new Set([...REPLACED, ...REPLACED_R2, ...REPLACED_DINO]);

const ISSUES = {
  'alligator.jpg': 'Extra/merged limb near jaw, ambiguous object in mouth',
  'alligator-habitat.jpg': 'Distorted body proportions, tail emerges too high',
  'alligator-secrets.jpg': 'Bird-like stick nest (wrong nest type), eggs exposed',
  'alligator-closeup.jpg': 'Neck/throat excessively thick and bulging',
  'anaconda-action.jpg': 'Reddish fleshy protrusion/appendage (extra limb)',
  'anaconda-closeup.jpg': '4 eyes or extra eye-like structures, wrong teeth',
  'anaconda-habitat.jpg': 'Wrong coloring (solid green vs spotted)',
  'anaconda-secrets.jpg': 'Head shape like lizard/eel, not snake',
  'anaconda.jpg': 'Jaw deformed/split, bifurcated lower jaw',
  'ankylosaurus-action.jpg': 'Different species (theropod), wrong head/teeth',
  'ankylosaurus-closeup.jpg': 'Horns look ceratopsian, not ankylosaurus',
  'ankylosaurus-habitat.jpg': 'Chimera body (stegosaurus plates + ceratopsian horn)',
  'ankylosaurus-secrets.jpg': 'Back plates have artificial glyphs/hieroglyphics',
  'ankylosaurus.jpg': 'Ceratopsian frill, missing tail club, mishmash body plan',
  'basilisk-action.jpg': 'Mythological ‚Äî limbs on snake, horns/spikes',
  'basilisk-closeup.jpg': 'Mythological ‚Äî limbs on snake, horns/spikes',
  'basilisk-habitat.jpg': 'Mythological ‚Äî limbs on snake, horns/spikes',
  'basilisk-secrets.jpg': 'Mythological ‚Äî limbs on snake, horns/spikes',
  'basilisk.jpg': 'Mythological ‚Äî limbs on snake, horns/spikes',
  'brachiosaurus-action.jpg': 'Only 2 legs visible, odd proportions',
  'brachiosaurus-closeup.jpg': 'Deformed rhinoceros-like head, horn-like eye protrusions',
  'brachiosaurus-habitat.jpg': 'Giraffe-like spots, raptor-like head',
  'brachiosaurus-secrets.jpg': 'Eating rocks (bizarre)',
  'brachiosaurus.jpg': 'Three eyes, giraffe spots, carnivorous teeth (herbivore!)',
  'cape-buffalo-secrets.jpg': 'Mirror-image composition, merged/deformed calves',
  'cape-buffalo.jpg': 'Exaggerated horn boss, unusually large/odd ears',
  'cerberus-action.jpg': 'Mythological ‚Äî multi-headed dog',
  'cerberus-closeup.jpg': 'Mythological ‚Äî multi-headed dog',
  'cerberus-habitat.jpg': 'Mythological ‚Äî multi-headed dog',
  'cerberus-secrets.jpg': 'Mythological ‚Äî multi-headed dog',
  'cerberus.jpg': 'Mythological ‚Äî multi-headed dog',
  'cheetah-action.jpg': '5 LEGS (extra front limb), different species in background',
  'cheetah-closeup.jpg': 'AI-generated face, tear lines asymmetrical',
  'cheetah-habitat.jpg': 'Rear anatomy compressed/truncated, only 2 legs visible',
  'cheetah-secrets.jpg': 'Graphic predation scene with prey remains',
  'cheetah.jpg': 'Hybrid cheetah-leopard face/proportions',
  'chimera-action.jpg': 'Mythological ‚Äî lion-goat-snake hybrid',
  'chimera-closeup.jpg': 'Mythological ‚Äî lion-goat-snake hybrid',
  'chimera-habitat.jpg': 'Mythological ‚Äî lion-goat-snake hybrid',
  'chimera-secrets.jpg': 'Mythological ‚Äî lion-goat-snake hybrid',
  'chimera.jpg': 'Mythological ‚Äî lion-goat-snake hybrid',
  'crocodile-action.jpg': 'Torso/neck unnaturally thick, forelimb deformed',
  'crocodile-closeup.jpg': 'Irregular teeth, plastic texture',
  'crocodile-habitat.jpg': 'Different species (bird), tail curls unnaturally',
  'crocodile-secrets.jpg': 'Baby crocodile deformed/fused limbs',
  'crocodile.jpg': 'Overly symmetrical, exaggerated eye ridges',
  'dragon-action.jpg': 'Mythological ‚Äî fire-breathing reptile',
  'dragon-closeup.jpg': 'Mythological ‚Äî fire-breathing reptile',
  'dragon-habitat.jpg': 'Mythological ‚Äî fire-breathing reptile',
  'dragon-secrets.jpg': 'Mythological ‚Äî fire-breathing reptile',
  'dragon.jpg': 'Mythological ‚Äî fire-breathing reptile',
  'eagle-action.jpg': 'Different species (fish visible), talons slightly off',
  'eagle-closeup.jpg': 'Beak unnaturally straight, nostrils odd',
  'eagle.jpg': 'Belly too white for bald eagle',
  'electric-eel-action.jpg': 'Looks like snake with fangs, wrong head shape',
  'electric-eel-closeup.jpg': 'Looks like snake with fangs, wrong head shape',
  'electric-eel-habitat.jpg': 'Looks like snake, shows bioluminescence (inaccurate)',
  'electric-eel-secrets.jpg': 'Looks like snake with fangs, wrong head shape',
  'electric-eel.jpg': 'Looks like snake with fangs, wrong head shape',
  'elephant-action.jpg': 'Only 3 legs visible, tusks from odd positions',
  'elephant-closeup.jpg': 'Tusks protrude from trunk itself (wrong!)',
  'elephant-secrets.jpg': 'Extra trunk-like appendage, deformed ears, stick-like legs',
  'elephant.jpg': 'Tusks asymmetrical unnaturally',
  'giant-panda-action.jpg': 'Extra/oddly-positioned paw (5 limbs)',
  'gorilla-action.jpg': 'Deformed/extra thumb, overly humanized/aggressive',
  'gorilla-secrets.jpg': 'Malformed fingers/hands',
  'great-horned-owl-action.jpg': 'Graphic predation, deformed prey',
  'great-horned-owl-closeup.jpg': 'Exaggerated fierce look',
  'great-white-shark-action.jpg': 'Oddly shaped pectoral fins, bulbous head',
  'great-white-shark-closeup.jpg': 'Deformed bloated face, human-like teeth',
  'great-white-shark.jpg': 'Different species (fish), unusual fin proportions',
  'griffin-action.jpg': '3 LEGS (extra limb)',
  'griffin-closeup.jpg': 'Deformed beak/cere, mammal-like nostrils',
  'griffin-habitat.jpg': 'CRITICAL: Lion-eagle chimera (6 limbs total)',
  'griffin-secrets.jpg': 'Oversized deformed legs/talons',
  'griffin.jpg': 'Bear-like ear tufts, primate-like face',
  'grizzly-bear-action.jpg': 'Fish visible (acceptable ‚Äî natural behavior)',
  'hammerhead-shark-action.jpg': 'Different species (ray), wire-like artifact',
  'hammerhead-shark-closeup.jpg': 'No visible eyes, humanized smile',
  'hammerhead-shark.jpg': 'Fishing line/lure artifact, disproportionate fin',
  'hammerhead-shark-habitat.jpg': 'Exaggerated head, manta ray-shark hybrid look',
  'hippo-action.jpg': 'Reptilian texture on snout',
  'hippo-secrets.jpg': 'BLOOD dripping from mouth, pool of blood in water',
  'hippo.jpg': 'Only one eye visible from near-frontal angle',
  'hydra-action.jpg': 'Mythological ‚Äî multi-headed snake',
  'hydra-closeup.jpg': 'Mythological ‚Äî multi-headed snake',
  'hydra-habitat.jpg': 'Mythological ‚Äî multi-headed snake',
  'hydra-secrets.jpg': 'Mythological ‚Äî multi-headed snake',
  'hydra.jpg': 'Mythological ‚Äî multi-headed snake',
  'hyena-action.jpg': 'Leopard-like legs, merged/deformed background faces',
  'hyena-habitat.jpg': 'Different species (rhino, vehicle in background)',
  'hyena-secrets.jpg': 'Merged/deformed bodies, too orange',
  'jaguar-action.jpg': 'Wrong spot pattern (cheetah-like), oversized paws',
  'jaguar-closeup.jpg': 'Deformed jaw/chin',
  'jaguar-habitat.jpg': 'Wrong spot pattern, missing tail',
  'jaguar.jpg': 'Deformed double-chin',
  'king-cobra.jpg': 'Second head at tail tip, rattlesnake pattern',
  'king-cobra-closeup.jpg': 'Watermark/copyright text',
  'king-cobra-action.jpg': '4 EYES instead of 2',
  'kraken-action.jpg': 'Mythological ‚Äî sea monster',
  'kraken-closeup.jpg': 'Mythological ‚Äî sea monster',
  'kraken-habitat.jpg': 'Mythological ‚Äî sea monster',
  'kraken-secrets.jpg': 'Mythological ‚Äî sea monster',
  'kraken.jpg': 'Mythological ‚Äî sea monster',
  'leopard-action.jpg': 'Gray/purple fabric/prey remains draped over tree',
  'leopard-closeup.jpg': 'AI-generated symmetry, uncanny eyes',
  'leopard-habitat.jpg': 'Dead prey carcass visible',
  'leopard.jpg': 'Lynx-like ears, jaguar-like face',
  'lion-closeup.jpg': 'Spotted nose/muzzle texture',
  'lion-habitat.jpg': 'Different species (zebras/wildebeest)',
  'lion.jpg': 'Deformed mouth/jaw, dark rectangular artifact',
  'mandrill-action.jpg': 'Frightening threat display with large fangs',
  'mandrill-habitat.jpg': 'Missing vivid face colors (looks like drill)',
  'mandrill-secrets.jpg': 'Abnormal elongated fingers',
  'manticore-action.jpg': 'Mythological ‚Äî lion-scorpion hybrid',
  'manticore-closeup.jpg': 'Mythological ‚Äî lion-scorpion hybrid',
  'manticore-habitat.jpg': 'Mythological ‚Äî lion-scorpion hybrid',
  'manticore-secrets.jpg': 'Mythological ‚Äî lion-scorpion hybrid',
  'manticore.jpg': 'Mythological ‚Äî lion-scorpion hybrid',
  'moose-action.jpg': 'Face lacks characteristic bulbous nose',
  'moose-closeup.jpg': 'Bell/object hanging from chin (domesticated?)',
  'moose-habitat.jpg': 'Exaggerated translucent antlers',
  'moose-secrets.jpg': 'Only 3 legs visible, small/asymmetrical antlers',
  'octopus-action.jpg': 'Only 5-6 arms visible, oversized white suckers',
  'octopus-closeup.jpg': 'Round pupils (should be horizontal slits)',
  'octopus-habitat.jpg': '10 arms instead of 8, nose-like protrusion',
  'octopus.jpg': 'Elephant trunk-like head, one eye',
  'orca-action.jpg': 'Deformed mouth, unnatural grin',
  'orca.jpg': 'Unnaturally symmetrical, cartoon-like eye patches',
  'phoenix-action.jpg': 'Mythological ‚Äî fire bird',
  'phoenix-closeup.jpg': 'Mythological ‚Äî fire bird',
  'phoenix-habitat.jpg': 'Mythological ‚Äî fire bird',
  'phoenix-secrets.jpg': 'Mythological ‚Äî fire bird',
  'phoenix.jpg': 'Mythological ‚Äî fire bird',
  'polar-bear-secrets.jpg': 'Right cub face deformed/merged',
  'polar-bear.jpg': 'Excessive claws, too-small head, overly symmetrical',
  'pteranodon-action.jpg': 'TWO HEADS/beaks, different species (fish)',
  'pteranodon-closeup.jpg': 'Frilled lizard-dinosaur hybrid',
  'pteranodon-habitat.jpg': 'Feathered wings (should be membrane)',
  'pteranodon-secrets.jpg': 'SIX LIMBS (wings + arms + legs)',
  'pteranodon.jpg': 'Unclear species, dinosaur-bird hybrid',
  'python-action.jpg': 'Deformed mouth/tongue',
  'python-closeup.jpg': 'Extra/deformed nostril structures',
  'python-habitat.jpg': 'Unnatural pattern regularity, merged coils',
  'python.jpg': 'Excessively symmetrical, deformed heat pits',
  'rhino-action.jpg': 'Deformed feet (merging into stumps), only 3 legs',
  'rhino-habitat.jpg': 'Only one horn, deformed/missing eye',
  'rhino-secrets.jpg': 'Only one horn, distorted eye/nostril',
  'rhino.jpg': 'Deformed tubular ear, distorted eye',
  'spinosaurus-action.jpg': 'Different species (fish), exaggerated sail',
  'spinosaurus-closeup.jpg': 'Generic monster face, not accurate snout',
  'spinosaurus-habitat.jpg': 'Dimetrodon-like sail, different species (fish)',
  'spinosaurus-secrets.jpg': 'FISH-DINOSAUR CHIMERA with fins and fish tail',
  'spinosaurus.jpg': 'Wrong head shape (theropod, not spinosaurus)',
  'stegosaurus-action.jpg': 'Different species (theropod), CARNIVORE TEETH',
  'stegosaurus-closeup.jpg': 'WRONG SPECIES: Styracosaurus/ceratopsian',
  'stegosaurus-habitat.jpg': 'Too few plates, no tail thagomizer',
  'stegosaurus-secrets.jpg': 'Glowing red dots, too many small red spikes',
  'stegosaurus.jpg': 'Horn on head (wrong!), CARNIVORE TEETH, too few plates',
  'tiger-action.jpg': 'Front legs appear merged',
  'triceratops-action.jpg': 'Hieroglyphic patterns on frill, missing nose horn',
  'triceratops-habitat.jpg': 'Different species in background, only 2 horns',
  'triceratops-secrets.jpg': 'Baby has only 2 horns',
  'triceratops.jpg': 'Only 2 horns, asymmetrical frill',
  'tyrannosaurus-rex-action.jpg': 'Extra appendage in mouth, 3 FINGERS (should be 2)',
  'tyrannosaurus-rex-habitat.jpg': '3 FINGERS, neck spines',
  'tyrannosaurus-rex-secrets.jpg': 'Different species (pterosaur), 3 FINGERS',
  'tyrannosaurus-rex.jpg': '3 FINGERS, oversized arms',
  'velociraptor-action.jpg': 'Wing membrane, blade tail, chimera body',
  'velociraptor-closeup.jpg': 'Ear tufts, head crest (wrong anatomy)',
  'velociraptor-habitat.jpg': 'Different species in background',
  'velociraptor-secrets.jpg': 'Porcupine-like quills, small sickle claw',
  'velociraptor.jpg': 'T. rex-like head, wrong proportions',
  'walrus-secrets.jpg': 'Only one tusk, asymmetrical face',
  'walrus.jpg': 'Smooth/symmetrical face, flat forehead, rectangular ears',
  'wolf-action.jpg': 'GRAPHIC PREDATION: merged wolf-deer figure',
  'wolf-closeup.jpg': 'Excessively symmetrical, phantom extra ears',
  'wolf-habitat.jpg': 'Thin elongated legs, merged bodies',
  'wolf-secrets.jpg': 'Merged legs/paws, bodies blend together',
};

const ANIMALS = [
  'alligator','anaconda','ankylosaurus','basilisk','brachiosaurus','cape-buffalo',
  'cerberus','cheetah','chimera','crocodile','dragon','eagle','electric-eel',
  'elephant','giant-panda','gorilla','great-horned-owl','great-white-shark','griffin',
  'grizzly-bear','hammerhead-shark','hippo','hydra','hyena','jaguar','king-cobra',
  'kraken','leopard','lion','mandrill','manticore','moose','octopus','orca','phoenix',
  'polar-bear','pteranodon','python','rhino','spinosaurus','stegosaurus','tiger',
  'triceratops','tyrannosaurus-rex','velociraptor','walrus','wolf'
];

// State
let decisions = JSON.parse(localStorage.getItem('fb-audit-decisions') || '{}');
let allImages = []; // flat list for lightbox nav
let lightboxIndex = -1;

function saveDecisions() {
  localStorage.setItem('fb-audit-decisions', JSON.stringify(decisions));
  updateStats();
}

function flagImage(filename, flag) {
  if (decisions[filename] === flag) {
    delete decisions[filename]; // toggle off
  } else {
    decisions[filename] = flag;
  }
  saveDecisions();
  renderCards();
}

function updateStats() {
  let okCount = 0, replaceCount = 0;
  Object.values(decisions).forEach(d => { if (d === 'ok') okCount++; else if (d === 'replace') replaceCount++; });
  const unreviewed = 235 - okCount - replaceCount;
  document.getElementById('reviewed-ok').textContent = okCount;
  document.getElementById('reviewed-replace').textContent = replaceCount;
  document.getElementById('unreviewed').textContent = unreviewed;
  document.getElementById('ai-flagged').textContent = Object.keys(ISSUES).length;

  const pct_ok = (okCount / 235 * 100).toFixed(1);
  const pct_replace = (replaceCount / 235 * 100).toFixed(1);
  document.getElementById('progress').innerHTML =
    `<div class="progress-ok" style="width:${pct_ok}%"></div>` +
    `<div class="progress-replace" style="width:${pct_replace}%"></div>`;
}

function renderCards() {
  document.querySelectorAll('.image-card').forEach(card => {
    const fn = card.dataset.filename;
    const d = decisions[fn];
    card.classList.remove('flagged-ok', 'flagged-replace');
    if (d === 'ok') card.classList.add('flagged-ok');
    if (d === 'replace') card.classList.add('flagged-replace');

    // Badge
    let badge = card.querySelector('.flag-badge');
    if (d) {
      if (!badge) { badge = document.createElement('div'); badge.className = 'flag-badge'; card.appendChild(badge); }
      badge.className = 'flag-badge ' + (d === 'ok' ? 'ok-badge' : 'replace-badge');
      badge.textContent = d === 'ok' ? '‚úì' : '‚úó';
    } else if (badge) { badge.remove(); }

    // Buttons
    card.querySelector('.btn-ok')?.classList.toggle('selected', d === 'ok');
    card.querySelector('.btn-replace')?.classList.toggle('selected', d === 'replace');
  });
  updateLightboxFlags();
}

// Build page
const container = document.getElementById('animals');
ANIMALS.forEach(animal => {
  const section = document.createElement('div');
  section.className = 'animal-section';
  let animalIssues = 0;
  let cards = '';

  TYPES.forEach(suffix => {
    const filename = `${animal}${suffix}.jpg`;
    const type = TYPE_LABELS[suffix];
    const issue = ISSUES[filename];
    if (issue) animalIssues++;
    const idx = allImages.length;
    allImages.push({ filename, animal, type, issue });
    const d = decisions[filename];

    const isNew = ALL_REPLACED.has(filename);
    const isR2 = REPLACED_R2.has(filename);
    const isDino = REPLACED_DINO.has(filename);
    cards += `<div class="image-card ${issue ? 'has-issue' : 'clean'} ${d === 'ok' ? 'flagged-ok' : d === 'replace' ? 'flagged-replace' : ''} ${isNew ? 'newly-replaced' : ''}"
      data-filename="${filename}" data-cat="${issue ? 'issue' : 'clean'}" data-has-issue="${!!issue}" data-is-new="${isNew}">
      ${isDino ? '<div class="new-badge" style="background:#fbbf24;color:#000">DINO</div>' : isR2 ? '<div class="new-badge" style="background:#a78bfa">PRO</div>' : isNew ? '<div class="new-badge">NEW</div>' : ''}
      ${d ? `<div class="flag-badge ${d === 'ok' ? 'ok-badge' : 'replace-badge'}">${d === 'ok' ? '‚úì' : '‚úó'}</div>` : ''}
      <img src="${BASE}/${filename}${isNew ? '?v=5' : ''}" alt="${animal} ${type}" loading="lazy"
        onclick="openLightbox(${idx})"
        onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22300%22 height=%22300%22><rect fill=%22%23222%22 width=%22300%22 height=%22300%22/><text x=%2250%25%22 y=%2250%25%22 fill=%22%23666%22 text-anchor=%22middle%22 dy=%22.3em%22>Not found</text></svg>'">
      <div class="image-info">
        <div class="image-filename">${filename}</div>
        <div class="image-type">${type}</div>
        ${issue ? `<div class="image-issue">${issue}</div>` : '<div class="image-ok-text">‚úì AI: no issues found</div>'}
        <div class="flag-buttons">
          <button class="flag-btn btn-ok ${d === 'ok' ? 'selected' : ''}" onclick="event.stopPropagation();flagImage('${filename}','ok')">‚úì OK</button>
          <button class="flag-btn btn-replace ${d === 'replace' ? 'selected' : ''}" onclick="event.stopPropagation();flagImage('${filename}','replace')">‚úó Replace</button>
        </div>
      </div>
    </div>`;
  });

  const severity = animalIssues >= 4 ? 'critical' : animalIssues >= 2 ? 'moderate' : 'clean';
  const badgeClass = severity === 'critical' ? 'badge-critical' : severity === 'moderate' ? 'badge-moderate' : 'badge-clean';
  const reviewedCount = TYPES.filter(s => decisions[`${animal}${s}.jpg`]).length;

  section.innerHTML = `
    <div class="animal-header" onclick="this.nextElementSibling.classList.toggle('open')">
      <span class="animal-name">${animal.replace(/-/g, ' ')}</span>
      <div class="animal-badges">
        ${reviewedCount > 0 ? `<span class="animal-badge badge-reviewed">${reviewedCount}/5 reviewed</span>` : ''}
        <span class="animal-badge ${badgeClass}">${animalIssues === 0 ? '‚úì AI clean' : `${animalIssues}/5 AI flagged`}</span>
      </div>
    </div>
    <div class="animal-body"><div class="image-grid">${cards}</div></div>`;

  section.dataset.issueCount = animalIssues;
  container.appendChild(section);
});

updateStats();

// Lightbox
function openLightbox(idx) {
  lightboxIndex = idx;
  const img = allImages[idx];
  const isReplaced = ALL_REPLACED.has(img.filename);
  document.getElementById('lb-img').src = `${BASE}/${img.filename}${isReplaced ? '?v=5' : ''}`;
  document.getElementById('lb-filename').textContent = `${img.filename} ‚Äî ${img.animal.replace(/-/g,' ')} (${img.type})`;
  document.getElementById('lb-issue').textContent = img.issue || 'No AI issues found';
  document.getElementById('lb-issue').style.color = img.issue ? '#ff9999' : '#88cc88';
  document.getElementById('lightbox').classList.add('active');
  updateLightboxFlags();
  document.body.style.overflow = 'hidden';
}

function closeLightbox() {
  document.getElementById('lightbox').classList.remove('active');
  document.body.style.overflow = '';
}

function navLightbox(dir) {
  let next = lightboxIndex + dir;
  if (next < 0) next = allImages.length - 1;
  if (next >= allImages.length) next = 0;
  openLightbox(next);
}

function flagFromLightbox(flag) {
  const fn = allImages[lightboxIndex].filename;
  flagImage(fn, flag);
  // Auto-advance to next
  setTimeout(() => navLightbox(1), 200);
}

function updateLightboxFlags() {
  if (lightboxIndex < 0) return;
  const fn = allImages[lightboxIndex].filename;
  const d = decisions[fn];
  document.querySelector('.lb-ok').classList.toggle('selected', d === 'ok');
  document.querySelector('.lb-replace').classList.toggle('selected', d === 'replace');
}

// Keyboard nav
document.addEventListener('keydown', e => {
  if (!document.getElementById('lightbox').classList.contains('active')) return;
  if (e.key === 'Escape') closeLightbox();
  if (e.key === 'ArrowLeft') navLightbox(-1);
  if (e.key === 'ArrowRight') navLightbox(1);
  if (e.key === '1' || e.key === 'g') flagFromLightbox('ok');
  if (e.key === '2' || e.key === 'r') flagFromLightbox('replace');
});

// Click outside to close
document.getElementById('lightbox').addEventListener('click', e => {
  if (e.target === document.getElementById('lightbox')) closeLightbox();
});

// Filters
document.querySelectorAll('.toolbar button[data-filter]').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.toolbar button[data-filter]').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    const filter = btn.dataset.filter;

    document.querySelectorAll('.animal-section').forEach(sec => {
      const cards = sec.querySelectorAll('.image-card');
      let visible = 0;
      cards.forEach(card => {
        const fn = card.dataset.filename;
        const hasIssue = card.dataset.hasIssue === 'true';
        const d = decisions[fn];
        let show = true;

        if (filter === 'issues') show = hasIssue;
        else if (filter === 'clean') show = !hasIssue;
        else if (filter === 'unreviewed') show = !d;
        else if (filter === 'approved') show = d === 'ok';
        else if (filter === 'replace') show = d === 'replace';
        else if (filter === 'new') show = card.dataset.isNew === 'true';
        else if (filter === 'dino') show = REPLACED_DINO.has(fn);

        card.classList.toggle('hidden', !show);
        if (show) visible++;
      });
      sec.classList.toggle('hidden', visible === 0);
      // Auto-expand sections when filtering
      if (filter !== 'all' && visible > 0) {
        sec.querySelector('.animal-body').classList.add('open');
      } else if (filter === 'all') {
        sec.querySelector('.animal-body').classList.remove('open');
      }
    });
  });
});

// Export
function exportDecisions() {
  const okList = [], replaceList = [];
  Object.entries(decisions).forEach(([fn, d]) => {
    const issue = ISSUES[fn] || null;
    if (d === 'ok') okList.push({ filename: fn, aiIssue: issue });
    if (d === 'replace') replaceList.push({ filename: fn, aiIssue: issue });
  });

  const data = {
    exportedAt: new Date().toISOString(),
    totalReviewed: Object.keys(decisions).length,
    approved: okList.length,
    replace: replaceList.length,
    unreviewed: 235 - Object.keys(decisions).length,
    approvedImages: okList,
    replaceImages: replaceList,
  };

  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = `image-audit-decisions-${new Date().toISOString().slice(0,10)}.json`;
  a.click(); URL.revokeObjectURL(url);
}
</script>
</body>
</html>
